
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>异步编程 · HonKit</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 3.7.5">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-cmb-pageview/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc/page-toc.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../node/" />
    
    
    <link rel="prev" href="设计模式.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    简介
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../计算机网络/计算机网络.html">
            
                <a href="../计算机网络/计算机网络.html">
            
                    
                    计算机网络
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../计算机网络/工具链和其他.html">
            
                <a href="../计算机网络/工具链和其他.html">
            
                    
                    工具链和其他
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../计算机网络/浏览器状态同步和路由.html">
            
                <a href="../计算机网络/浏览器状态同步和路由.html">
            
                    
                    浏览器状态同步和路由
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../计算机网络/网络安全攻防.html">
            
                <a href="../计算机网络/网络安全攻防.html">
            
                    
                    网络安全攻防
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../杂篇/">
            
                <a href="../杂篇/">
            
                    
                    杂篇
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../杂篇/踩坑日记.html">
            
                <a href="../杂篇/踩坑日记.html">
            
                    
                    踩坑日记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../杂篇/预习资料.html">
            
                <a href="../杂篇/预习资料.html">
            
                    
                    预习资料
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../杂篇/直播.html">
            
                <a href="../杂篇/直播.html">
            
                    
                    直播
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../Angular/">
            
                <a href="../Angular/">
            
                    
                    Angular
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../Angular/Angular学习笔记.html">
            
                <a href="../Angular/Angular学习笔记.html">
            
                    
                    Angular学习笔记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../Angular/flutter的学习笔记.html">
            
                <a href="../Angular/flutter的学习笔记.html">
            
                    
                    flutter的学习笔记
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="./">
            
                <a href="./">
            
                    
                    js进阶
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="高阶函数.html">
            
                <a href="高阶函数.html">
            
                    
                    高阶函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="轮播图设计.html">
            
                <a href="轮播图设计.html">
            
                    
                    轮播图设计
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="设计模式.html">
            
                <a href="设计模式.html">
            
                    
                    设计模式
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.4" data-path="异步编程.html">
            
                <a href="异步编程.html">
            
                    
                    异步编程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../node/">
            
                <a href="../node/">
            
                    
                    node
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../node/node_01.html">
            
                <a href="../node/node_01.html">
            
                    
                    node_01
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../node/node_02.html">
            
                <a href="../node/node_02.html">
            
                    
                    node_02
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../node/node_03.html">
            
                <a href="../node/node_03.html">
            
                    
                    node_03
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../node/node的web框架koa.html">
            
                <a href="../node/node的web框架koa.html">
            
                    
                    node的web框架koa
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../node/node基础.html">
            
                <a href="../node/node基础.html">
            
                    
                    node基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../node/node与mongDB.html">
            
                <a href="../node/node与mongDB.html">
            
                    
                    node与mongDB
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../react/">
            
                <a href="../react/">
            
                    
                    react
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../react/React前厅（基础）.html">
            
                <a href="../react/React前厅（基础）.html">
            
                    
                    React前厅（基础）
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../vue/">
            
                <a href="../vue/">
            
                    
                    vue
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../vue/TypeScript.html">
            
                <a href="../vue/TypeScript.html">
            
                    
                    TypeScript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../vue/vue3.html">
            
                <a href="../vue/vue3.html">
            
                    
                    vue3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../vue/vue基础.html">
            
                <a href="../vue/vue基础.html">
            
                    
                    vue基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../vue/vue生态.html">
            
                <a href="../vue/vue生态.html">
            
                    
                    vue生态
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../z-Clean-Architecture/">
            
                <a href="../z-Clean-Architecture/">
            
                    
                    Clean-Architecture
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../z-Clean-Architecture/01-第一部分-概述/">
            
                <a href="../z-Clean-Architecture/01-第一部分-概述/">
            
                    
                    第一部分-概述
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1.1" data-path="../z-Clean-Architecture/01-第一部分-概述/1-设计与架构究竟是什么.html">
            
                <a href="../z-Clean-Architecture/01-第一部分-概述/1-设计与架构究竟是什么.html">
            
                    
                    设计与架构究竟是什么
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.1.2" data-path="../z-Clean-Architecture/01-第一部分-概述/2-两个价值维度.html">
            
                <a href="../z-Clean-Architecture/01-第一部分-概述/2-两个价值维度.html">
            
                    
                    两个价值维度
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../z-Clean-Architecture/02-第二部分-从基础构件开始：编程范式/">
            
                <a href="../z-Clean-Architecture/02-第二部分-从基础构件开始：编程范式/">
            
                    
                    第二部分-从基础构件开始：编程范式
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.2.1" data-path="../z-Clean-Architecture/02-第二部分-从基础构件开始：编程范式/3-编程范式总览.html">
            
                <a href="../z-Clean-Architecture/02-第二部分-从基础构件开始：编程范式/3-编程范式总览.html">
            
                    
                    编程范式总览
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.2" data-path="../z-Clean-Architecture/02-第二部分-从基础构件开始：编程范式/4-结构化编程.html">
            
                <a href="../z-Clean-Architecture/02-第二部分-从基础构件开始：编程范式/4-结构化编程.html">
            
                    
                    结构化编程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.3" data-path="../z-Clean-Architecture/02-第二部分-从基础构件开始：编程范式/5-面向对象编程.html">
            
                <a href="../z-Clean-Architecture/02-第二部分-从基础构件开始：编程范式/5-面向对象编程.html">
            
                    
                    面向对象编程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2.4" data-path="../z-Clean-Architecture/02-第二部分-从基础构件开始：编程范式/6-函数式编程.html">
            
                <a href="../z-Clean-Architecture/02-第二部分-从基础构件开始：编程范式/6-函数式编程.html">
            
                    
                    函数式编程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../z-Clean-Architecture/03-第三部分-设计原则/">
            
                <a href="../z-Clean-Architecture/03-第三部分-设计原则/">
            
                    
                    第三部分-设计原则
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.3.1" data-path="../z-Clean-Architecture/03-第三部分-设计原则/7-SRP：单一职责原则.html">
            
                <a href="../z-Clean-Architecture/03-第三部分-设计原则/7-SRP：单一职责原则.html">
            
                    
                    SRP：单一职责原则
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.2" data-path="../z-Clean-Architecture/03-第三部分-设计原则/8-OCP：开闭原则.html">
            
                <a href="../z-Clean-Architecture/03-第三部分-设计原则/8-OCP：开闭原则.html">
            
                    
                    OCP：开闭原则
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.3" data-path="../z-Clean-Architecture/03-第三部分-设计原则/9-LSP：里氏替换原则.html">
            
                <a href="../z-Clean-Architecture/03-第三部分-设计原则/9-LSP：里氏替换原则.html">
            
                    
                    LSP：里氏替换原则
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.4" data-path="../z-Clean-Architecture/03-第三部分-设计原则/10-ISP：接口隔离原则.html">
            
                <a href="../z-Clean-Architecture/03-第三部分-设计原则/10-ISP：接口隔离原则.html">
            
                    
                    ISP：接口隔离原则
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3.5" data-path="../z-Clean-Architecture/03-第三部分-设计原则/11-DIP：依赖反转原则.html">
            
                <a href="../z-Clean-Architecture/03-第三部分-设计原则/11-DIP：依赖反转原则.html">
            
                    
                    DIP：依赖反转原则
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../z-Clean-Architecture/04-第四部分-组件构建原则/">
            
                <a href="../z-Clean-Architecture/04-第四部分-组件构建原则/">
            
                    
                    第四部分-组件构建原则
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.4.1" data-path="../z-Clean-Architecture/04-第四部分-组件构建原则/12-组件.html">
            
                <a href="../z-Clean-Architecture/04-第四部分-组件构建原则/12-组件.html">
            
                    
                    组件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4.2" data-path="../z-Clean-Architecture/04-第四部分-组件构建原则/13-组件聚合.html">
            
                <a href="../z-Clean-Architecture/04-第四部分-组件构建原则/13-组件聚合.html">
            
                    
                    组件聚合
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4.3" data-path="../z-Clean-Architecture/04-第四部分-组件构建原则/14-组件耦合.html">
            
                <a href="../z-Clean-Architecture/04-第四部分-组件构建原则/14-组件耦合.html">
            
                    
                    组件耦合
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../z-Clean-Architecture/05-第五部分-软件架构/">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/">
            
                    
                    第五部分-软件架构
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.5.1" data-path="../z-Clean-Architecture/05-第五部分-软件架构/15-什么是软件架构.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/15-什么是软件架构.html">
            
                    
                    什么是软件架构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5.2" data-path="../z-Clean-Architecture/05-第五部分-软件架构/16-独立性.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/16-独立性.html">
            
                    
                    独立性
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5.3" data-path="../z-Clean-Architecture/05-第五部分-软件架构/17-划分边界.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/17-划分边界.html">
            
                    
                    划分边界
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5.4" data-path="../z-Clean-Architecture/05-第五部分-软件架构/18-边界剖析.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/18-边界剖析.html">
            
                    
                    边界剖析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5.5" data-path="../z-Clean-Architecture/05-第五部分-软件架构/19-策略与层次.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/19-策略与层次.html">
            
                    
                    策略与层次
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5.6" data-path="../z-Clean-Architecture/05-第五部分-软件架构/20-业务逻辑.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/20-业务逻辑.html">
            
                    
                    业务逻辑
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5.7" data-path="../z-Clean-Architecture/05-第五部分-软件架构/21-尖叫的软件架构.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/21-尖叫的软件架构.html">
            
                    
                    尖叫的软件架构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5.8" data-path="../z-Clean-Architecture/05-第五部分-软件架构/22-整洁架构.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/22-整洁架构.html">
            
                    
                    整洁架构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5.9" data-path="../z-Clean-Architecture/05-第五部分-软件架构/23-展示器和谦卑对象.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/23-展示器和谦卑对象.html">
            
                    
                    展示器和谦卑对象
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5.10" data-path="../z-Clean-Architecture/05-第五部分-软件架构/24-不完全边界.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/24-不完全边界.html">
            
                    
                    不完全边界
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5.11" data-path="../z-Clean-Architecture/05-第五部分-软件架构/25-层次与边界.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/25-层次与边界.html">
            
                    
                    层次与边界
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5.12" data-path="../z-Clean-Architecture/05-第五部分-软件架构/26-Main组件.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/26-Main组件.html">
            
                    
                    Main组件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5.13" data-path="../z-Clean-Architecture/05-第五部分-软件架构/27-服务：宏观和微观.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/27-服务：宏观和微观.html">
            
                    
                    服务：宏观和微观
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5.14" data-path="../z-Clean-Architecture/05-第五部分-软件架构/28-测试边界.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/28-测试边界.html">
            
                    
                    测试边界
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5.15" data-path="../z-Clean-Architecture/05-第五部分-软件架构/29-整洁的嵌入式架构.html">
            
                <a href="../z-Clean-Architecture/05-第五部分-软件架构/29-整洁的嵌入式架构.html">
            
                    
                    整洁的嵌入式架构
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../z-Clean-Architecture/06-第六部分-实现细节/">
            
                <a href="../z-Clean-Architecture/06-第六部分-实现细节/">
            
                    
                    第六部分-实现细节
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.6.1" data-path="../z-Clean-Architecture/06-第六部分-实现细节/30-数据库只是实现细节.html">
            
                <a href="../z-Clean-Architecture/06-第六部分-实现细节/30-数据库只是实现细节.html">
            
                    
                    数据库只是实现细节
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6.2" data-path="../z-Clean-Architecture/06-第六部分-实现细节/31-Web是实现细节.html">
            
                <a href="../z-Clean-Architecture/06-第六部分-实现细节/31-Web是实现细节.html">
            
                    
                    Web是实现细节
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6.3" data-path="../z-Clean-Architecture/06-第六部分-实现细节/32-应用程序框架是实现细节.html">
            
                <a href="../z-Clean-Architecture/06-第六部分-实现细节/32-应用程序框架是实现细节.html">
            
                    
                    应用程序框架是实现细节
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6.4" data-path="../z-Clean-Architecture/06-第六部分-实现细节/33-案例分析：视频销售网站.html">
            
                <a href="../z-Clean-Architecture/06-第六部分-实现细节/33-案例分析：视频销售网站.html">
            
                    
                    案例分析：视频销售网站
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6.5" data-path="../z-Clean-Architecture/06-第六部分-实现细节/34-拾遗.html">
            
                <a href="../z-Clean-Architecture/06-第六部分-实现细节/34-拾遗.html">
            
                    
                    拾遗
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../z-Clean-Architecture/afterword.html">
            
                <a href="../z-Clean-Architecture/afterword.html">
            
                    
                    afterword
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >异步编程</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>[TOC]</p>
<h2 id="javascript进阶">javascript进阶</h2>
<h3 id="异步编程">异步编程</h3>
<h4 id="理解异步">理解异步</h4>
<h5 id="同步函数：">同步函数：</h5>
<p>当一个函数是同步执行时，那么当该函数被调用时不会立即返回，直到该函数所要做的事情全都做完了才返回。<strong>同步阻塞</strong></p>
<p>处理机制：当一个线程调用一个同步函数时，如果该函数没有立即完成规定的操作，则该操作会导致该调用线程<strong>挂起</strong>（将CPU的使用权交给系统，让系统分配给其他线程使用），直到该同步函数规定的操作完成才返回，最终该调用线程才能被重新调度。</p>
<h5 id="异步函数：">异步函数：</h5>
<p>如果一个异步函数被调用时，该函数会立即返回，尽管该函数规定的操作任务还没有完成。<strong>异步非阻塞</strong></p>
<p>处理机制：当一个线程调用一个同步函数时，该函数会立即返回<em>尽管其规定的任务还没有完成</em>，这样子线程就会执行异步函数的下一条语句，而不会被<strong>挂起阻塞</strong>。<em>该异步函数所规定的工作是由另外一个线程完成的</em>。</p>
<h5 id="进程与线程">进程与线程</h5>
<p> <strong>进程是 CPU资源分配的最小单位；线程是 CPU调度的最小单位</strong>。
一个进程由一个或多个线程组成，线程是一个进程中代码的不同执行路线</p>
<blockquote>
<p>进程：一个程序的运行实例。cpu分配资源的最小单位。</p>
<p>通过<strong>时间片调度算法</strong>来实现多进程进行，或者说<strong>并行执行</strong>（如听音乐的同时写文档）</p>
<p>线程：cpu能够运算调度的最小单元。在进程中并行执行不同部分的任务。</p>
<p>线程实际上是为了优化时间片调度机制中，时间片到期后进程之间切换的速度，所开拓出来的</p>
</blockquote>
<p>chrome浏览器中的主要线程：</p>
<ul>
<li>浏览器（Browser）：控制 “Chrome” 应用程序，包括地址栏、书签、后退和前进按钮等。还需要处理 Web 浏览器的权限管理，例如网络请求和文件访问。</li>
<li>渲染器（Renderer）：控制选项卡内，网站里显示的所有内容。</li>
<li>插件（Plugin）：控制网站使用的插件，例如：Flash。</li>
<li>GPU：独立于其他进程，专用于处理 GPU 任务，它被分成不同的进程，因为 GPU 会处理来自多个进程的请求，并将它们绘制在相同的 Surface 中。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/jasonk0/myImage-blog/master/imgs/浏览器的多进程.png" alt="多进程"></p>
<p>浏览器的进程模式</p>
<p>为了节省内存，Chrome提供了四种进程模式(Process Models)，不同的进程模式会对 tab 进程做不同的处理。</p>
<ul>
<li><p>Process-per-site-instance (default) - 同一个 site-instance 使用一个进程</p>
</li>
<li><p>Process-per-site - 同一个 site 使用一个进程</p>
</li>
<li><p>Process-per-tab - 每个 tab 使用一个进程</p>
</li>
<li><p>Single process - 所有 tab 共用一个进程</p>
</li>
</ul>
<h5 id="被调用方通知调用方的方法：">被调用方通知调用方的方法：</h5>
<p><img src="../Users/jasonk0/Library/Application Support/typora-user-images/image-20220105181001203.png" alt="image-20220105181001203"></p>
<ul>
<li>回调</li>
</ul>
<ul>
<li>事件</li>
</ul>
<ul>
<li>消息</li>
</ul>
<h5 id="面试题">面试题</h5>
<p><strong>为什么不建议采用定时器实现动画？requestAnimationFrame有哪些优势？</strong></p>
<blockquote>
<p>定时器的回调不能保证是按照指定时间之后调用 只是会按照指定时间被插入任务队列 要等待主线程空闲才会被调用</p>
<p> 所以不能保证是在渲染的每帧开始的时候执行动画 也就可能出现跳帧</p>
<p>另外，通过定时器修改元素位置属性实现的动画，会导致频繁的重排和重绘，从而影响到性能。</p>
<p> <strong>requestAnimationFrame最大的优势是由浏览器来决定回调函数的执行时机，即紧跟浏览器的刷新步调。</strong></p>
<p> 如果屏幕刷新频率是60Hz，那么回调函数每16.7ms被执行一次，如果屏幕刷新频率是75Hz，那么这个时间间隔就变成了1000/75=13.3ms。它能保证回调函数在屏幕每一次的刷新间隔中只被执行一次，这样就不会引起丢帧现象，自然不会导致动画的卡顿。</p>
<p> CPU节能：使用setTimeout实现的动画，当页面被隐藏（隐藏的<code>&lt;iframe&gt;</code>）或最小化（后台标签页）时，setTimeout仍然在后台执行动画任务，由于此时页面处于不可见或不可用状态，刷新动画是没有意义的，而且还浪费 CPU 资源和电池寿命。而requestAnimationFrame则完全不同，当页面处于未激活的状态下，该页面的屏幕绘制任务也会被浏览器暂停，因此跟着浏览器步伐走的requestAnimationFrame也会停止渲染，当页面被激活时，动画就从上次停留的地方继续执行，有效节省了 CPU 开销，提升性能和电池寿命。</p>
</blockquote>
<p><strong>浏览器采用多进程架构有什么优势和劣势？</strong></p>
<blockquote>
<p>优势：单个tab页具有更好的健壮性，安全性、沙盒性。在面临一个进程崩盘的时候，并不会影响其他网页应用线程。更快的响应速度</p>
<p>劣势：占用内存更大，更加耗费资源。</p>
</blockquote>
<hr>
<h4 id="eventloop事件循环">EventLoop事件循环</h4>
<h5 id="为什么javascript要设计成单线程？">为什么JavaScript要设计成单线程？</h5>
<p>js的设计之初就是为了执行脚本，不管是执行脚本，还是渲染dom、操作dom、发送请求，其目标都是呈现页面，单线程恰恰保证了呈现页面的过程中不会发生冲突，所以根本使用不到多线程；发展到如今的js所负担的任务变得沉重，但因为webwoker和EventLoop机制，单线程丝毫不影响其运行效率，</p>
<h5 id="什么是eventloop？">什么是EventLoop？</h5>
<ol>
<li>在执行主线程的任务时，如果有<em>异步任务</em>，会进入到Event Table并注册回调函数，当指定的事情完成后，会将这个回调函数放到 <strong>callback queue</strong> 中</li>
<li>在主线程执行完毕之后，会去读取 <strong>callback queue</strong>中的回调函数，进入主线程执行</li>
<li>不断的重复这个过程，也就是常说的Event Loop（事件循环）了</li>
</ol>
<p><img src="https://www.hualigs.cn/image/61d79a25735b1.jpg" alt="EventLoop整体循环"></p>
<p>重点在于<em>异步任务</em>，他们分为宏任务和微任务，两者区别于在指定的事情完成后，将回调函数放入 <strong>callback queue</strong> 的过程。</p>
<p>我们也不难看出，<strong>dom渲染</strong>会在微任务队列清空后进行。</p>
<h5 id="宏任务与微任务">宏任务与微任务</h5>
<blockquote>
<p>我们通常把宿主发起的任务称为<strong>宏观任务</strong>(<code>script</code>其实也算宏任务，但因为他们只执行一遍，所以接下来宏任务里不讨论<code>script</code>的存在)，把JavaScript引擎发起的任务称为<strong>微观任务</strong></p>
</blockquote>
<p>常见宏任务：<code>setInterval()</code>，<code>serTimeout()</code>，<code>setImmediate()</code>(实际上<code>setImmediate()</code>优先级小于前者)</p>
<p>常见微任务：<code>Promise().then(function(){})</code>（promise-then里的回调函数，<code>new MUtationObserver()</code> </p>
<p><code>process.nextTick(function(){})</code>(同上)(另外，实际上后者优先级高于前者)</p>
<p>两者在事件轮询中的区别在于，轮询到微任务时，会将微任务队列全部推出再去轮询下一步；轮询到宏任务时，只推出了队列中最早的异步任务</p>
<p><strong>为什么要设计微任务？</strong></p>
<blockquote>
<p>解决了宏任务执行时机不可控的问题。微任务宏任务将异步分成了缓急两个任务队列</p>
</blockquote>
<h5 id="简述事件循环闭环流程">简述事件循环闭环流程</h5>
<blockquote>
<p>我们可以想象成<strong>宏任务</strong>循环里套着<strong>微任务</strong>循环，<em>在检查宏任务之前</em>，<em>执行完宏任务之后</em>，分别插入<strong>微任务循环</strong>。</p>
</blockquote>
<p>宏任务过程：</p>
<ol>
<li>选择宏任务队列中最早的任务（任务A）</li>
<li>将“当前正在运行的任务”设置为“任务A”</li>
<li>运行“任务A”同步代码（也就是运行回调函数）</li>
<li>将“当前正在运行的任务”设置为<code>null</code>，删除“任务A”，本次Loop结束</li>
<li>选择下一个最早的任务，也就是跳转到1，直到宏任务队列清空</li>
</ol>
<pre><code class="lang-mermaid">graph LR

1 ==&gt; 2
2 ==&gt; 3 
3 ==微任务循环==&gt; 4 
4 ==微任务循环==&gt; 1
</code></pre>
<p>微任务过程：</p>
<p>a. 选择微任务队列中最早的任务（任务x）</p>
<p>b. 将“当前正在运行的任务”设置为“任务x”</p>
<p>c. 运行“任务x”同步代码（也就是运行回调函数）</p>
<p>d. 将“当前正在运行的任务”设置为<code>null</code>，删除“任务x”</p>
<p>e. 选择下一个最早的任务，也就是跳转到1，直到微任务队列清空</p>
<p><img src="https://www.hualigs.cn/image/61d64fbf783f8.jpg" alt></p>
<p><img src="https://www.hualigs.cn/image/61d6eede46ca4.jpg" alt="EventLoop演示图"></p>
<h5 id="浏览器和node的区别">浏览器和node的区别</h5>
<p>宏任务
| \                                   | 浏览器 | Node |
| ----------------------------------- | ------ | ---- |
| I/O                                 | ✅      | ✅    |
| setTimeout                          | ✅      | ✅    |
| setInterval                         | ✅      | ✅    |
| setImmediate                        | ❌      | ✅    |
| requestAnimationFrame               | ✅      | ✅    |
| 页面交互：DOM、鼠标、键盘、滚动事件 | ✅      | ✅    |
| script                              | ✅      |      |</p>
<p>微任务
| /                          | 浏览器 | Node |
| -------------------------- | ------ | ---- |
| process.nextTick           | ❌      | ✅    |
| MutationObserver           | ✅      | ❌    |
| Promise.then catch finally | ✅      | ✅    |</p>
<h5 id="vue的异步更新队列">vue的异步更新队列</h5>
<p>会优先选择微任务<code>Promise.then</code>、<code>MutationObserver</code> 和 <code>setImmediate</code>，如果执行环境不支持，则会采用宏任务<code>setTimeout(fn, 0)</code> 代替。</p>
<h4 id="发布-订阅">发布-订阅</h4>
<blockquote>
<p>浏览器进程里有许多线程，但主线程是<code>JavaScript引擎</code>，其他线程都是为了服务主线程而存在。而这些线程之间通讯方式就是通过<strong>发布-订阅</strong>来完成的，也称<strong>消息队列</strong></p>
</blockquote>
<h5 id="异步编程的解决方案">异步编程的解决方案</h5>
<p>最早的社区版本就是用的<strong>发布-订阅</strong>，后来改进到<code>deferred</code>对象，也就是早期的<code>Preomise</code>对象</p>
<p>后来发布了官方规范<code>Promise</code> =&gt;  <code>Geneatator</code> =&gt;  <code>async/await</code></p>
<p>他们的终极目的都是一样的——以同步的方式书写异步代码</p>
<h5 id="发布-订阅模式与观察者模式的区别">发布-订阅模式与观察者模式的区别</h5>
<p>发布订阅模式：可以完全解耦代码，发布者与订阅者之间没有必然联系，他们并不知道彼此的存在，只通过事件中心的消息进行通讯</p>
<p>观察者模式：<strong>被观察者</strong><code>Subject</code>只需要去维护一套<strong>观察者集合</strong><code>Observer</code>，在状态发生变更时，去自动通知观察者集合里的<strong>观察者</strong><code>Watcher</code>，这个模式是松耦合的，他们是清楚彼此的存在的。</p>
<h4 id="深入理解promise">深入理解promise</h4>
<p>异步操作的回调嵌套也就是回调地狱</p>
<p>当使用第三方异步函数，并给他传入异步之后的<strong>回调函数</strong>时，会产生可靠性丢失，其实是转移了控制权</p>
<p>期待第三方函数可以做到：</p>
<ul>
<li>不会太早调用我的回调函数</li>
<li>不会太迟调用我的回调函数</li>
<li>会给我的回调提供必要的参数</li>
<li>在我的回调失败的时候会提醒我</li>
</ul>
<p>但事实上我们控制不了以上的几点</p>
<p>所以<code>Promise</code>诞生了，解决了<strong>可靠性丢失</strong>，但依然存在<strong>回调地狱</strong></p>
<p><code>Promise</code>会在异步事件完成之后给我发送<strong>成功与否</strong>的通知，而不是我给它传入回调，控制权始终在自己手中。也就是发布订阅模式</p>
<p><strong>缺点</strong></p>
<ul>
<li>无法取消<code>Promise</code>，一旦新建他就会立即执行，无法中途取消</li>
<li>如果不设置回调函数，<code>Promise</code>内部抛出的错误，就不会反映到外部</li>
<li>当处于<code>pending</code>状态时，无法得知目前进展到哪一个阶段（刚刚开始还是即将完成）</li>
</ul>
<h4 id="generator函数及其异步使用">Generator函数及其异步使用</h4>
<p>非抢夺式任务</p>
<p>进程在执行完成之后主动让出执行权</p>
<p>抢夺式任务</p>
<p>也就是通过时间片来决定执行权，也通过优先权</p>
<p>协程 </p>
<p>在用户明确放弃执行权的时候，才主动让出。</p>
<p><img src="https://www.hualigs.cn/image/61d81bcee5e05.jpg" alt="协程描述"></p>
<pre><code class="lang-javascript"><span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">gen</span>(<span class="hljs-params">x</span>)</span>{
  <span class="hljs-keyword">var</span> y = <span class="hljs-keyword">yield</span> x + <span class="hljs-number">2</span>;
  <span class="hljs-keyword">return</span> y
}
<span class="hljs-keyword">var</span> g = gen(<span class="hljs-number">1</span>)
g.next() <span class="hljs-comment">// {value:3, done:false}</span>
g.next() <span class="hljs-comment">// {value:undefined, done:true}</span>
</code></pre>
<h4 id="thunk函数的generator自执行器">Thunk函数的Generator自执行器</h4>
<p>thunk函数将参数和回调分开，封装固定部分参数，再执行时传入回调参数。</p>
<pre><code class="lang-javascript">test(a,b,cb)
thunkTest = thunk(test)(a,b)
thunkTest(cb1)
thunkTest(cb2)...
<span class="hljs-comment">// 实现Thunk</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">thunk</span>(<span class="hljs-params">fn</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">let</span> args = [...arguments]
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>)</span>{
            fn.apply(<span class="hljs-keyword">this</span>,[...args,cb])
    }
  }
}
</code></pre>
<p>Generator自调用函数</p>
<p>就是让生成器能够自动执行，将包含<code>next()</code>的回调传入下一个thunk化的异步函数中</p>
<pre><code class="lang-javascript">add(a,b,cb)
cb = <span class="hljs-built_in">console</span>.log
addThunk = Thunk(add)
<span class="hljs-comment">// addThunk函数接受了固定参数之后还可以接收回调函数</span>
<span class="hljs-comment">// 回调函数，是上一个yield的结果，传入的</span>
<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">gen</span>(<span class="hljs-params"></span>)</span>{
  <span class="hljs-keyword">yield</span> addThunk(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)
  <span class="hljs-keyword">yield</span> addThunk(<span class="hljs-number">3</span>,<span class="hljs-number">4</span>)
  ...
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params">fn</span>)</span>{
  <span class="hljs-keyword">let</span> g = fn()
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">next</span>(<span class="hljs-params">err,data</span>)</span>{
        <span class="hljs-keyword">let</span> ret = g.next(data)
    <span class="hljs-keyword">if</span>(ret.done) <span class="hljs-keyword">return</span>
    ret.value(next) <span class="hljs-comment">//这里是addThunk绑定了ab之后返回的函数</span>
                                    <span class="hljs-comment">// 需要继续绑定回调，然后next被传进去了</span>
  }
  next()
}  
run(gen)
</code></pre>
<h4 id="co模块源码分析">co模块源码分析</h4>
<h4 id="深入理解async-await">深入理解async await</h4>
<p>异步终极解决方案，Generator的语法糖</p>
<blockquote>
<p>语法糖：用更简练的言语表达复杂的含义，在得到广泛接受的情况之下，可以提升交流的效率</p>
</blockquote>
<h5 id="generator与async的差异"><code>Generator</code>与<code>async</code>的差异</h5>
<p><code>async</code>自带执行器</p>
<p><code>async</code>清晰的语义</p>
<p><code>async</code>的返回值是<code>Promise</code>对象，而<code>Genarator</code>的返回值是<code>Iterator</code>对象</p>
<p><code>async</code>的<code>await</code>命令后面，可以是<code>Promise</code>对象和原始类型的值（数值、字符串和布尔值，但这时会自动转换成立即<code>resolved</code>的<code>Promise</code>对象）</p>
<h5 id="await线程睡眠">await线程睡眠</h5>
<p>在执行到<code>await</code>后边的异步任务时，会阻塞其他<code>await</code>操作，直到异步任务完成，才能进行下一个<code>await</code></p>
<h5 id="async的错误处理">async的错误处理</h5>
<ol>
<li><p>通过<code>try{}catch(e){}</code>来捕捉错误</p>
</li>
<li><p>在<code>await</code>语句后边跟上<code>.catch()</code></p>
</li>
</ol>
<h5 id="async的并发处理">async的并发处理</h5>
<pre><code class="lang-javascript"><span class="hljs-keyword">let</span> foo = <span class="hljs-keyword">await</span> getFoo()
<span class="hljs-keyword">let</span> bar = <span class="hljs-keyword">await</span> getBar()
<span class="hljs-comment">// 这样子书写，getBar会被getFoo阻塞，</span>
<span class="hljs-comment">// 但实际上在两个没有关联的操作间这种阻塞是没有必要的</span>
<span class="hljs-comment">// 可以通过Promise.all()</span>
<span class="hljs-keyword">let</span> [foo,bar] = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([getFoo(),getBar()])
<span class="hljs-comment">// 或者直接进行这个异步操作，在拿到结果后，再await</span>
<span class="hljs-keyword">let</span> fooPromise = getFoo()
<span class="hljs-keyword">let</span> barPromise = getBar()
<span class="hljs-keyword">let</span> foo = <span class="hljs-keyword">await</span> fooPromise
<span class="hljs-keyword">let</span> bar = <span class="hljs-keyword">await</span> barPromise
</code></pre>
<h5 id="深入理解async">深入理解<code>async</code></h5>
<pre><code class="lang-javascript"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span>(<span class="hljs-params">args</span>)</span>{
  <span class="hljs-comment">//...</span>
}
<span class="hljs-comment">// 等同于</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fn</span>(<span class="hljs-params">args</span>)</span>{
  <span class="hljs-keyword">return</span> packing(<span class="hljs-function"><span class="hljs-keyword">function</span>* (<span class="hljs-params"></span>)</span>{

  })
} 
<span class="hljs-comment">// packing</span>
</code></pre>
<h4 id="手写promise">手写promise</h4>
<p>高频面试题</p>
<ol>
<li><p>Promise解决了什么问题？</p>
<p>异步任务执行信任问题，地狱嵌套</p>
</li>
<li><p>Promise在事件循环中的执行过程是怎样的？</p>
<p>加入到微任务队列</p>
</li>
<li><p>Promise有什么缺陷，可以如何解决？</p>
<p>无法取消<code>Promise</code>，一旦新建他就会立即执行，无法中途取消</p>
<p>如果不设置回调函数，<code>Promise</code>内部抛出的错误，就不会反映到外部</p>
<p>当处于<code>pending</code>状态时，无法得知目前进展到哪一个阶段（刚刚开始还是即将完成）</p>
</li>
</ol>
<ol>
<li>手写符合Promise/A+规范的Promise</li>
</ol>
<p>Promise的规范：</p>
<ol>
<li>三种状态，只有异步操作的结果可以决定当前是哪一种状态</li>
<li>状态的变化不可逆，且只有两种情况。</li>
<li>一个promise必须提供一个then方法，用来获取当前异步操作的value或error</li>
<li>then方法接受两个参数onFulfilled，onRejected</li>
<li>then方法返回的是一个新的Promise实例</li>
</ol>
<pre><code class="lang-javascript"><span class="hljs-keyword">var</span> cache = {}
<span class="hljs-keyword">var</span> container = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
  flags = <span class="hljs-keyword">typeof</span> flags == <span class="hljs-string">&quot;string&quot;</span> ? (cache[flags] || createFlags(flags)): exted({},flags)
  <span class="hljs-keyword">var</span> stack = [] <span class="hljs-comment">//回调列表</span>
  <span class="hljs-keyword">var</span> fire = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>{
    <span class="hljs-keyword">var</span> len = stack.length
    <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span>(;i&lt;len;i++){
      stack[i].apply(data[<span class="hljs-number">0</span>],data[<span class="hljs-number">1</span>])
    }
  }
  <span class="hljs-keyword">var</span> self = {
    <span class="hljs-attr">add</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>)</span>{
        <span class="hljs-built_in">Array</span>.from(args).forEach(<span class="hljs-function">(<span class="hljs-params">arg</span>)=&gt;</span>{
          <span class="hljs-keyword">if</span>(toString.call(arg) === <span class="hljs-string">&quot;[object Function]&quot;</span>){
            <span class="hljs-comment">// 检测重复的回调</span>
            <span class="hljs-keyword">if</span>(!self.has(arg)){
                          stack.push(arg)


            }
          }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(arg &amp;&amp; arg.length &amp;&amp; <span class="hljs-keyword">typeof</span> arg !==<span class="hljs-string">&quot;string&quot;</span>){
              add(arg)
            }
        })
      })(<span class="hljs-built_in">arguments</span>)
    },
    <span class="hljs-comment">// 这里一定要传值，区分resolve和reject</span>
    startupWith: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ctx,args</span>)</span>{
      args = args || []
      args = [ctx,args]
      fire(args)
    }
    startup: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">this</span>)</span>{
      self.startupWith(<span class="hljs-keyword">this</span>,<span class="hljs-built_in">arguments</span>)
    }
    has: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>)</span>{
      <span class="hljs-keyword">return</span> stack.indexOf(fn) &gt; <span class="hljs-number">-1</span>
    }
  }
  <span class="hljs-keyword">return</span> self
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createFlags</span>(<span class="hljs-params">flags</span>)</span>{
  <span class="hljs-keyword">var</span> res = {}
  (flags.match(<span class="hljs-regexp">/\S+/g</span>) || []).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">flag</span>)</span>{
    res[flag] = <span class="hljs-literal">true</span>
  })
}
</code></pre>
<h5 id="再次手写">再次手写</h5>
<pre><code class="lang-javascript"><span class="hljs-string">``</span><span class="hljs-string">`



#### Web Worker多线程机制

单线程无法完全发挥出多核CPU的性能

主线程碰到费时的操作时，分配给Web Worker线程去执行，等到执行完再将结果返回给主线程

##### 历史

2009-firefox

2012-IE浏览器，以及其他浏览器

2015发布的版本沿用至今

##### DedicatedWorker和SharedWorker两种规范 

SharedWorker：所有页面都可以访问SharedWorker；兼用性特别差

DedicatedWorker：单个页面只能访问当前页面下的Worker

##### 用户感知性能模型RAIL

&gt; 同步JS执行时间不能过长，量化来说，播放动画时建议小于16ms，用户操作相应建议小于100ms，页面打开到呈现内容建议小于1000ms

一个渲染帧也就是16ms

渲染帧流程：

![流程](https://www.hualigs.cn/image/61de49eda9cce.jpg)

如果加载js时间超过16ms，那就会失去一个渲染帧，页面就会出现卡顿。

优化：

![优化](https://www.hualigs.cn/image/61de4a248da1f.jpg)

##### 同步任务的异步化执行

![worker的工作原理](https://www.hualigs.cn/image/61de4456456b0.jpg)

将可能耗时过长的Jank Job，移到Woker 线程，从而实现主线程和Worker线程的并行执行，直到Jank Job返回结果给到主线程

##### Worker对于性能提升

其实并没有性能提升，性能只于CPU相关，单核CPU就慢，多核CPU就快。其实在分配Woker线程的时候也需要时间、空间，包括线程之间的通讯，都需要额外的性能；当然这在多核CPU上是不算什么，它们会并行执行；而在单核CPU上它们是通过时间片机制轮转的。

Woker所提升的是用户体验，是UI渲染流畅度。

##### Worker的通讯

通讯开销：在主线程post =&gt; woker的onMessage接收，这中间是有时间差的

`</span><span class="hljs-string">``</span>javascript
<span class="hljs-comment">//main.js</span>
<span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> Worker(<span class="hljs-string">&apos;./worker.js&apos;</span>)
worker.postMessage(<span class="hljs-string">&apos;hello&apos;</span>)
worker.onmessage = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-built_in">console</span>.log(event.data) <span class="hljs-comment">//world</span>
}
<span class="hljs-comment">//worker.js</span>
self.onmessage = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-built_in">console</span>.log(event.data) <span class="hljs-comment">//hello</span>
  postMessage(<span class="hljs-string">&apos;world&apos;</span>)
}
</code></pre>
<h5 id="worker的运行环境">Worker的运行环境</h5>
<p><img src="https://www.hualigs.cn/image/61de47dfcb78a.jpg" alt="环境对比"></p>
<p>相同点</p>
<p><img src="https://www.hualigs.cn/image/61de480b875ec.jpg" alt="相同点"></p>
<p>差异点</p>
<p><img src="https://www.hualigs.cn/image/61de484eb2a84.jpg" alt="差异"></p>
<h4 id="rxjs复杂异步场景">Rxjs复杂异步场景</h4>
<h5 id="reactive-extension推">Reactive Extension(推)</h5>
<p>对很多语言都有支持，是实践响应式编程的一套工具。</p>
<p><code>Rxjs</code>是<strong>推送数据</strong>的，不管是异步还是同步数据。</p>
<ul>
<li>数据流抽象了很多现实问题</li>
<li>擅长处理异步操作</li>
<li>把复杂问题分解成简单问题的组合</li>
</ul>
<p><code>Observable</code>和<code>Observer</code></p>
<p><strong>可被观察者</strong>和<strong>观察者</strong>，连接两者的桥梁是<code>Observable</code>对象的函数<code>subscribe</code>；<code>Rxjs</code>中的数据流就是<code>Observable</code>对象，它实现了以下两种设计模式</p>
<ul>
<li><p>观察者模式</p>
<p><img src="https://www.hualigs.cn/image/61decc76149c3.jpg" alt="观察者"></p>
</li>
<li><p>迭代器模式</p>
<p>能够遍历一个数据集合的对象，因为数据集合的实现方式很多，可以是一个数组，也可以是一个树形结构，也可以是一个单向链表……迭代器的作用及时提供一个通用的接口，让使用者完全不用关心这个数据集合的具体实现方式</p>
<p>通常包含这样几个函数</p>
<ul>
<li><code>getCurrent</code>，获取当前被游标所指向的元素</li>
<li><code>next</code>，将游标移动到下一个元素，调用这个函数之后，<code>getCurrent</code>获得的元素就会不同。</li>
<li><code>isDone</code>判断是否已经遍历完所有的元素</li>
</ul>
</li>
</ul>
<h5 id="跨越时间的observable">跨越时间的<code>Observable</code></h5>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> source = <span class="hljs-keyword">new</span> Observable(<span class="hljs-function"><span class="hljs-params">subscriber</span> =&gt;</span>{
  <span class="hljs-keyword">let</span> n = <span class="hljs-number">1</span>
  <span class="hljs-keyword">const</span> handle = setInterval(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>{
    subscriber.next(n++)
    <span class="hljs-keyword">if</span>(n&gt;<span class="hljs-number">3</span>){
      clearInterval(handle)
      subscriber.conplete()<span class="hljs-comment">// =&gt; 进入到了完成终结状态</span>
      subscriber.error(e) <span class="hljs-comment">// =&gt; 进入到了错误终结状态</span>
    } 
  },<span class="hljs-number">1000</span>)
})

source.subscriber({
  next(x){
    <span class="hljs-built_in">console</span>.log(x)
  },
  complete(){ <span class="hljs-comment">// =&gt; 进入到了完成终结状态</span>
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;no data&apos;</span>)
  },
  error(e){ <span class="hljs-comment">// =&gt; 进入到了错误终结状态</span>
    <span class="hljs-built_in">console</span>.log(e)
  }
})
</code></pre>
<h5 id="退订observable">退订<code>Observable</code></h5>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> source = <span class="hljs-keyword">new</span> Observable(<span class="hljs-function"><span class="hljs-params">subscriber</span> =&gt;</span>{
  <span class="hljs-keyword">let</span> n = <span class="hljs-number">1</span>
  <span class="hljs-comment">// 无限推送</span>
  <span class="hljs-keyword">const</span> handle = setInterval(<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>{
    subscriber.next(n++)
    <span class="hljs-keyword">return</span> { <span class="hljs-comment">// 这个对象赋值给了sub</span>
      unsubscribe:<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>{
        clearInterval(handle)
      }
    }
  },<span class="hljs-number">1000</span>)
})

<span class="hljs-keyword">const</span> sub = source.subscriber({
  next(x){
    <span class="hljs-built_in">console</span>.log(x)
  },
<span class="hljs-comment">//      三秒之后退订</span>
  setTimeout(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      sub.unsubscribe()
},<span class="hljs-number">3000</span>)
})
</code></pre>
<h5 id="创建数据流">创建数据流</h5>
<p>同步数据流，或者说同步<code>Observable</code>对象，需要关心的就是：产生哪些数据；数据之间的先后顺序如何。</p>
<p>对于同步数据流，数据之间的时间间隔不存在，所以不需要考虑时间方面的问题</p>
<p>同步操作符，<code>of</code>操作符</p>
<p>异步数据流，在<code>Rxjs</code>中<code>interval</code>和<code>timer</code>两个操作符就相当于<code>Javascript</code>中的<code>setInterval</code>和<code>setTimeout</code></p>
<p><code>from</code>操作符把任何对象转换成<code>Observable</code>对象</p>
<p><code>Promise</code>和<code>Rxjs</code>的对比</p>
<ul>
<li><code>Rxjs</code>多次执行</li>
<li><code>Rxjs</code>取消订阅</li>
</ul>
<h4 id="拓展">拓展</h4>
<p>异步考试题</p>
<pre><code class="lang-javascript"><span class="hljs-comment">// Promise.resolve()</span>
<span class="hljs-comment">//   .then(&apos;b&apos;)</span>
<span class="hljs-comment">//   .then(Promise.resolve(&apos;c&apos;))</span>
<span class="hljs-comment">//   .then(console.log)</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// Promise.resolve({</span>
<span class="hljs-comment">//   then: function () {</span>
<span class="hljs-comment">//     console.log(&apos;a&apos;);</span>
<span class="hljs-comment">//   }</span>
<span class="hljs-comment">// }).then(() =&gt; { console.log(&apos;d&apos;); })</span>
<span class="hljs-comment">//-----//</span>
<span class="hljs-comment">// Promise.resolve({</span>
<span class="hljs-comment">//   then: function (fullfill) {</span>
<span class="hljs-comment">//     fullfill(&apos;a&apos;);</span>
<span class="hljs-comment">//     console.log(&apos;b&apos;)</span>
<span class="hljs-comment">//     throw new Error(&apos;c&apos;)</span>
<span class="hljs-comment">//     console.log(&apos;d&apos;);</span>
<span class="hljs-comment">//   }</span>
<span class="hljs-comment">// }).then(</span>
<span class="hljs-comment">//   (d) =&gt; { console.log(d); },</span>
<span class="hljs-comment">//   (err) =&gt; { console.log(err.message); },</span>
<span class="hljs-comment">// );</span>
<span class="hljs-comment">//-----</span>

<span class="hljs-comment">// Promise.resolve(3).then(() =&gt; {</span>
<span class="hljs-comment">//   console.log(&apos;a&apos;);</span>
<span class="hljs-comment">//   throw new Error(&apos;b&apos;);</span>
<span class="hljs-comment">// }).then(() =&gt; {</span>
<span class="hljs-comment">//   console.log(&apos;c&apos;);</span>
<span class="hljs-comment">// }, (err) =&gt; {</span>
<span class="hljs-comment">//   console.log(err.message);</span>
<span class="hljs-comment">//   return &apos;d&apos;;</span>
<span class="hljs-comment">// }).then((d) =&gt; console.log(&apos;d&apos;), (e) =&gt; { console.log(&apos;e&apos;) })</span>
<span class="hljs-comment">//------</span>
<span class="hljs-comment">// new Promise(function (resolve, reject) {</span>
<span class="hljs-comment">//   resolve(&apos;a&apos;);</span>
<span class="hljs-comment">//   throw new Error(&apos;b&apos;);</span>
<span class="hljs-comment">// })</span>
<span class="hljs-comment">//   .then(console.log)</span>
<span class="hljs-comment">//   .catch(console.log);</span>
<span class="hljs-comment">//------</span>
<span class="hljs-comment">// function* gen() {</span>
<span class="hljs-comment">//   var a = yield &apos;a&apos;;</span>
<span class="hljs-comment">//   var b = yield a + &apos;b&apos;;</span>
<span class="hljs-comment">//   return b;</span>
<span class="hljs-comment">// }</span>
<span class="hljs-comment">// var g = gen();</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// console.log(g.next());</span>
<span class="hljs-comment">// console.log(g.next(&apos;c&apos;));</span>
<span class="hljs-comment">// console.log(g.next());</span>
<span class="hljs-comment">//-----</span>
<span class="hljs-comment">// function* gen1() {</span>
<span class="hljs-comment">//   yield &apos;a&apos;;</span>
<span class="hljs-comment">//   yield &apos;b&apos;;</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// function* gen2() {</span>
<span class="hljs-comment">//   yield* gen1();</span>
<span class="hljs-comment">//   yield &apos;c&apos;;</span>
<span class="hljs-comment">//   yield &apos;d&apos;;</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// function* gen3() {</span>
<span class="hljs-comment">//   gen1();</span>
<span class="hljs-comment">//   yield &apos;c&apos;;</span>
<span class="hljs-comment">//   yield &apos;d&apos;;</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// const g2 = gen2();</span>
<span class="hljs-comment">// const g3 = gen3();</span>
<span class="hljs-comment">// for (let v of g2) {</span>
<span class="hljs-comment">//   console.log(v);</span>
<span class="hljs-comment">// }</span>
<span class="hljs-comment">// for (let v of g3) {</span>
<span class="hljs-comment">//   console.log(v);</span>
<span class="hljs-comment">// }</span>
<span class="hljs-comment">//------</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">geneP</span>(<span class="hljs-params">d1, d2</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>{
    <span class="hljs-keyword">if</span> (+<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>() &gt; <span class="hljs-number">0</span>) {
      resolve(d1);
    } <span class="hljs-keyword">else</span> {
      reject(d2);
    }
  });
}
<span class="hljs-function"><span class="hljs-keyword">function</span>* <span class="hljs-title">gen</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">yield</span> geneP(<span class="hljs-string">&apos;yes&apos;</span>, <span class="hljs-string">&apos;no&apos;</span>);
  <span class="hljs-keyword">yield</span> geneP(<span class="hljs-string">&apos;y&apos;</span>, <span class="hljs-string">&apos;n&apos;</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params">fn</span>) </span>{
  <span class="hljs-keyword">var</span> g = fn();
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">next</span>(<span class="hljs-params">data</span>) </span>{
    <span class="hljs-built_in">console</span>.log(data);
    <span class="hljs-keyword">var</span> result = g.next();
    <span class="hljs-built_in">console</span>.log(result.value);
    <span class="hljs-keyword">if</span> (result.done) <span class="hljs-keyword">return</span>;
    result.value.then(next);
  }
  next();
}

run(gen);


<span class="hljs-comment">//-----</span>
<span class="hljs-comment">// async function async1() {</span>
<span class="hljs-comment">//   console.log(&apos;1&apos;);</span>
<span class="hljs-comment">//   console.log(await async2()); // 0</span>
<span class="hljs-comment">//   console.log(&apos;2&apos;);</span>
<span class="hljs-comment">// }</span>
<span class="hljs-comment">// async function async2() {</span>
<span class="hljs-comment">//   console.log(&apos;3&apos;);</span>
<span class="hljs-comment">//   return &apos;0&apos;;</span>
<span class="hljs-comment">// }</span>
<span class="hljs-comment">// setTimeout(function () { // hong</span>
<span class="hljs-comment">//   console.log(&apos;4&apos;);</span>
<span class="hljs-comment">//   new Promise(function (resolve) {</span>
<span class="hljs-comment">//     console.log(&apos;5&apos;); resolve();</span>
<span class="hljs-comment">//   }).then(function () { console.log(&apos;6&apos;) })</span>
<span class="hljs-comment">// })</span>
<span class="hljs-comment">// async1();</span>
<span class="hljs-comment">// new Promise(function (resolve) {</span>
<span class="hljs-comment">//   console.log(&apos;7&apos;);</span>
<span class="hljs-comment">//   resolve();</span>
<span class="hljs-comment">// }).then(function () {</span>
<span class="hljs-comment">//   console.log(&apos;8&apos;); </span>
<span class="hljs-comment">//  return 10</span>
<span class="hljs-comment">// }).then(n =&gt; console.log(n));</span>
<span class="hljs-comment">// console.log(&apos;9&apos;);</span>
<span class="hljs-comment">// // 1 3 7 9 0 2 8</span>
</code></pre>
<hr>
<h3 id="设计模式">设计模式</h3>
<footer class="page-footer"><span class="copyright">© Jasonk0 all right reserved，powered by Gitbook</span><span class="footer-modification">该文件修订时间：
2022-07-20 10:55:44
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="设计模式.html" class="navigation navigation-prev " aria-label="Previous page: 设计模式">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../node/" class="navigation navigation-next " aria-label="Next page: node">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"异步编程","level":"1.5.4","depth":2,"next":{"title":"node","level":"1.6","depth":1,"path":"node/README.md","ref":"node/README.md","articles":[{"title":"node_01","level":"1.6.1","depth":2,"path":"node/node_01.md","ref":"node/node_01.md","articles":[]},{"title":"node_02","level":"1.6.2","depth":2,"path":"node/node_02.md","ref":"node/node_02.md","articles":[]},{"title":"node_03","level":"1.6.3","depth":2,"path":"node/node_03.md","ref":"node/node_03.md","articles":[]},{"title":"node的web框架koa","level":"1.6.4","depth":2,"path":"node/node的web框架koa.md","ref":"node/node的web框架koa.md","articles":[]},{"title":"node基础","level":"1.6.5","depth":2,"path":"node/node基础.md","ref":"node/node基础.md","articles":[]},{"title":"node与mongDB","level":"1.6.6","depth":2,"path":"node/node与mongDB.md","ref":"node/node与mongDB.md","articles":[]}]},"previous":{"title":"设计模式","level":"1.5.3","depth":2,"path":"js进阶/设计模式.md","ref":"js进阶/设计模式.md","articles":[]},"dir":"ltr"},"config":{"plugins":["chapter-fold","hide-element","tbfed-pagefooter","highlight","code","back-to-top-button","cmb-pageview","page-toc","custom-favicon"],"root":"bookEdit","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"&copy Jasonk0","modify_label":"该文件修订时间：","modify_format":"YYYY-MM-DD HH:mm:ss"},"chapter-fold":{},"search":{},"cmb-pageview":{},"page-toc":{"selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4","position":"top","showByDefault":false},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"code":{"copyButtons":true},"hide-element":{"elements":[".gitbook-link"]},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"favicon":"icon/favicon.ico","back-to-top-button":{},"custom-favicon":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"producer":"jasonk0","structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"js进阶/异步编程.md","mtime":"2022-07-20T02:55:44.752Z","type":"markdown"},"gitbook":{"version":"3.7.5","time":"2022-07-26T15:00:13.117Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-cmb-pageview/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc/anchor-3.1.1.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc/page-toc.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

